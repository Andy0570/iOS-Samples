# CYLTabBarController

GitHub: [CYLTabBarController](https://github.com/ChenYilong/CYLTabBarController)

Star: 5.8k



å®˜æ–¹æè¿°ï¼š

> ã€ä¸­å›½ç‰¹è‰² TabBarã€‘ä¸€è¡Œä»£ç å®ç° Lottie åŠ¨ç”» TabBarï¼Œæ”¯æŒä¸­é—´å¸¦ + å·çš„ TabBar æ ·å¼ï¼Œè‡ªå¸¦çº¢ç‚¹è§’æ ‡ï¼Œæ”¯æŒåŠ¨æ€åˆ·æ–°ã€‚ã€iOS13 & Dark Mode & iPhone XS MAX supportedã€‘ã€‚



## å‰è¨€

é¦–å…ˆï¼šä¸ä»…ä»…æ˜¯ä¸€è¡Œä»£ç ï¼

å®˜æ–¹å£°ç§°çš„ "ä¸€è¡Œä»£ç å®ç° Lottie åŠ¨ç”» TabBar" å…¶å®æœ‰è™šæ™ƒä¸€æªçš„å«Œç–‘ï¼Œè®©ä½ å¬èµ·æ¥è¯¯ä»¥ä¸ºç”¨**ä¸€è¡Œä»£ç **å°±å¯ä»¥å®ç°æ·˜å®ã€Œé—²é±¼ã€é‚£ç§æ—¢å¸¦ â• å·æŒ‰é’®åˆå¸¦ Lottie åŠ¨ç”»çš„ TabBar äº†ã€‚å…¶å®æŠ˜è…¾ä¸‹æ¥è¿˜æ˜¯è¦å†™ä¸ªå‡ ç™¾è¡Œä»£ç çš„ã€‚

æ‰€è°“çš„ "ä¸€è¡Œä»£ç å®ç° Lottie åŠ¨ç”»â€ï¼Œå…¶å®å°±æ˜¯é…ç½®æ–¹æ³•é‡Œé¢å†åŠ ä¸€ä¸ª key å€¼ä¸º  `CYLTabBarLottieURL` çš„å±æ€§ï¼Œå®ƒçš„å€¼æ˜¯ä¸€ä¸ª `NSURL` é“¾æ¥ï¼ŒæŒ‡å‘ä½ é¡¹ç›®ä¸­æè¿° Lottie åŠ¨ç”»çš„ JSON æ–‡ä»¶ã€‚ä½ è¿˜æ˜¯éœ€è¦è‡ªå·±æå‰å‡†å¤‡å¥½ Lottie çš„ JSON æ–‡ä»¶çš„ï¼Œæ‰€ä»¥è¯´ï¼Œæ‰€è°“çš„ä¸€è¡Œä»£ç å°±æ˜¯ï¼Œå½“æ¶‰åŠåˆ° Lottie åŠ¨ç”»æ—¶ï¼Œä½ ç»™ç³»ç»Ÿä¼ ä¸€ä¸ªå¸¦ Lottie åŠ¨ç”»çš„ URL æ–‡ä»¶ï¼ˆæ—¢ç„¶â€œä¸€è¡Œä»£ç â€æ˜¯è¿™ä¸ªæ„æ€çš„è¯ï¼Œæˆ‘æ˜¯ä¸æ˜¯å¯ä»¥è¯´ä¸€è¡Œä»£ç å®ç°ä¸€ä¸ªå…¨å¥— Google æœç´¢å¼•æ“åŠŸèƒ½å‘¢ï¼Ÿæ‰“å¼€ä¸€ä¸ª google.com çš„ HTML 5 é¡µé¢ä¸å°±å®ç°äº†å—ï¼Ÿï¼‰ã€‚

å¦å¤–ï¼Œä¸€çœ‹è§ **CYLTabBarController** è¿™ä¸ªæ¡†æ¶æ˜¯å›½äººå†™çš„ï¼Œè€Œä¸” README æ–‡æ¡£æ˜¯ä¸­æ–‡çš„ï¼ŒçœŸçš„æ˜¯å–œæè€Œæ³£ğŸ˜¹ï¼Œè®©æˆ‘è¯¯ä»¥ä¸ºèŠ±ä¸ª 5 åˆ†é’Ÿä¾¿å¯ä»¥ä»å…¥é—¨åˆ°ç²¾é€šï¼Œæœ€ç»ˆæŠ˜è…¾äº†å¥½å‡ å¤©ï¼Œä¸‹è½½äº†å¥½å‡ ä¸ª Demo æ‰ç®—å¼„æ˜ç™½ã€‚

é‰´äºå®˜æ–¹ README.md æ–‡æ¡£çš„å«ç³Šä¸æ¸…ï¼Œä¸é…å¥— Demo å†™æ³•ä¸Šä¹Ÿå­˜åœ¨å¾ˆå¤§çš„å‡ºå…¥ï¼Œè¿˜æ˜¯è®©ä¸€å¼€å§‹åˆå…¥äº†è§£è¯¥æ¡†æ¶çš„åŒå­¦é€ æˆäº†å¾ˆå¤§çš„å›°æ‰°ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä¼šé€šè¿‡å®ç°ä¸€ä¸ªæ¨¡ä»¿ã€Œé—²é±¼ã€TabBar åŠ¨ç”»çš„ Demo æ¥è®©å¤§å®¶é‡æ–°äº†è§£å®ƒã€‚



## å¼€å§‹ä½¿ç”¨

### å‡†å¤‡ï¼šæ–°å»º Xcode é¡¹ç›®

åœ¨ Xcode 11 ç¯å¢ƒä¸‹æ–°å»ºä¸€ä¸ª **Single View App** é¡¹ç›®ï¼Œæ‰“å¼€è¿™ä¸ªæ–°çš„é¡¹ç›®ï¼Œå¯ä»¥çœ‹åˆ°ç³»ç»Ÿé™¤äº†ä¼šè‡ªåŠ¨ç”Ÿæˆ `AppDelegate` æ–‡ä»¶å¤–ï¼Œè¿˜ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåä¸º `SceneDelegate` çš„ç±»æ–‡ä»¶ã€‚

![é¡¹ç›®ç›®å½•](https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/100356.png)

âš ï¸  `SceneDelegate`  æ˜¯ iOS 13 ä¸‹çš„æ–°ç‰¹æ€§ï¼ŒæŸ¥çœ‹ [WWDC 2019: Optimizing App Launch](https://developer.apple.com/videos/play/wwdc2019/423/) å¯ä»¥çŸ¥é“è¿™åˆ°åº•æ˜¯å•¥ï¼Œä½†æ˜¯ **CYLTabBarController** è¿˜æœªé€‚é…è¯¥ç‰¹æ€§ï¼ˆæˆªæ­¢ 1.28.3 ç‰ˆæœ¬ï¼‰ï¼ŒåŸºäº `SceneDelegate` é›†æˆè¯¥æ¡†æ¶åº”ç”¨ä¼šå´©æºƒï¼æ‰€ä»¥æˆ‘ä»¬è¦å…ˆæŠŠ `SceneDelegate` ç‰¹æ€§åˆ é™¤æ‰è¡Œã€‚

æ­¥éª¤ï¼š

1. é¦–å…ˆæ‰“å¼€ `Info.plist` æ–‡ä»¶ï¼Œæ‰¾åˆ°ä¸‹é¢è¿™ä¸¤ä¸ªå±æ€§å¹¶åˆ é™¤ã€‚ 

![](https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/100858.png)

2. åˆ é™¤ `SceneDelegate` ç±»æ–‡ä»¶ï¼Œå…¶å®å¯åˆ å¯ä¸åˆ ï¼Œä½†æ—¢ç„¶æˆ‘ä»¬ç”¨ä¸åˆ°å°±åˆ äº†å§ã€‚
3. ä¿®æ”¹ `AppDelegate.h` æ–‡ä»¶ï¼ŒåŠ ä¸Š `UIWindow` å±æ€§ã€‚

```objective-c
#import <UIKit/UIKit.h>

@interface AppDelegate : UIResponder <UIApplicationDelegate>

@property (strong, nonatomic) UIWindow * window;

@end
```

4. ä¿®æ”¹ `AppDelegate.m` æ–‡ä»¶ï¼Œè®¾ç½® `UIWindow`  è®¾ç½®ä¸»çª—å£ï¼Œå¹¶**åˆ é™¤å¤šä½™çš„ <UISceneSession> ä»£ç†åè®®**ã€‚

```objc
#import "AppDelegate.h"
#import "ViewController.h"

@interface AppDelegate ()

@end

@implementation AppDelegate


- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
    
    self.window = [[UIWindow alloc] initWithFrame:[[UIScreen mainScreen] bounds]];
    // è®¾ç½®æ ¹è§†å›¾æ§åˆ¶å™¨
    ViewController *controller = [[ViewController alloc] init];
    // çª—å£æ ¹è§†å›¾æ§åˆ¶å™¨
    self.window.rootViewController = controller;
    self.window.backgroundColor = [UIColor whiteColor];
    [self.window makeKeyAndVisible];
    
    return YES;
}

// ä¸‹é¢å¤šä½™çš„ä»£ç è¯·åˆ é™¤

@end
```

è¿è¡Œé¡¹ç›®ï¼Œæ— æŠ¥é”™åˆ™ç»§ç»­å¾€ä¸‹ã€‚



### ç¬¬ä¸€æ­¥ï¼šä½¿ç”¨ CocoaPods å¯¼å…¥ CYLTabBarController

å¯ä»¥å¾ˆè‰¯å¿ƒçš„è¯´ï¼ŒREADME.md æ–‡æ¡£ä¸­åœ¨ [ç¬¬ä¸€æ­¥ä½¿ç”¨ CocoaPods å¯¼å…¥ CYLTabBarController](https://github.com/ChenYilong/CYLTabBarController#ç¬¬ä¸€æ­¥ä½¿ç”¨cocoapodså¯¼å…¥cyltabbarcontroller) ä¸€ç« ç®—æ˜¯æè¿°åœ°æœ€è¯¦å°½çš„äº†ï¼Œå®ƒå±…ç„¶è¿˜æ•™ä½ å¦‚ä½•å®‰è£… CocoaPodsï¼Œå ªæ¯” CocoaPods ç¯å¢ƒæ­å»ºæ•™ç¨‹äº†ã€‚

ä½†æ˜¯ï¼Œæœ‰ä¸€ç‚¹éœ€è¦æé†’çš„æ˜¯ï¼Œå®‰è£… CocoaPods è¯·å‹¿ä½¿ç”¨  `sudo gem install cocoapods` è¿™ä¸ªå‘½ä»¤ï¼Œå¦‚æœè¿è¡Œè¯¥å‘½ä»¤æç¤ºå­˜åœ¨æƒé™é—®é¢˜ï¼š

```bash
# é”™è¯¯ç¤ºä¾‹
$ sudo gem install cocoapods
Password:
Fetching cocoapods-1.8.4.gem
Fetching cocoapods-core-1.8.4.gem
Successfully installed cocoapods-core-1.8.4
ERROR:  While executing gem ... (Gem::FilePermissionError)
    You don't have write permissions for the /usr/bin directory.
# Mac OS ç³»ç»Ÿå‡çº§ä¹‹åï¼Œç³»ç»ŸæŠŠ /usr/bin ç›®å½•çš„å†™å…¥æƒé™ç¦ç”¨äº†ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æŒ‡å®šå®‰è£…åˆ°åˆ«çš„ç›®å½•ä¸‹ã€‚

# æ­£ç¡®ç¤ºä¾‹ï¼Œéœ€è¦å®‰è£… cocoapods åˆ°æŒ‡å®šç›®å½•ä¸‹
$ sudo gem install cocoapods -n /usr/local/bin
Successfully installed cocoapods-1.8.4
Parsing documentation for cocoapods-1.8.4
Installing ri documentation for cocoapods-1.8.4
Done installing documentation for cocoapods after 2 seconds
1 gem installed
```

å¦å¤–ï¼ŒPodfile ç¤ºä¾‹æ–‡ä»¶å¦‚ä¸‹ï¼š

```bash
# Uncomment the next line to define a global platform for your project
platform :ios, '9.0'

target 'CYLTabBarControllerDemo' do
  # Comment the next line if you don't want to use dynamic frameworks
  # use_frameworks!

  # Pods for CYLTabBarControllerDemo
  pod 'CYLTabBarController', '~> 1.28.3'        # é»˜è®¤ä¸ä¾èµ–Lottie
  pod 'CYLTabBarController/Lottie', '~> 1.28.1' # ä¾èµ–Lottieåº“
  pod 'ChameleonFramework'                      # é¢œè‰²æ¡†æ¶
  pod 'YYKit'                                   # ä¼šç”¨åˆ°å‡ ä¸ªè¾…åŠ©æ–¹æ³•

end
```



### ç¬¬äºŒæ­¥ï¼šæ–°å»º AppDelegate åˆ†ç±»æ–‡ä»¶ï¼Œåˆå§‹åŒ–å¹¶è®¾ç½® CYLTabBarController 

 å¦‚æœä½ æŸ¥çœ‹ CYLTabBarController æ¡†æ¶çš„ README.md æ–‡æ¡£ï¼Œä½œè€…ä¼šè®©ä½ æŠŠå¾ˆå¤šé…ç½®æ–¹æ³•å†™åœ¨ `AppDelegate` è¿™ä¸ªç±»ä¸­ã€‚

ä½†å®é™…åº”ç”¨åœºæ™¯ä¸­ï¼Œæœ‰å¾ˆå¤šé…ç½®æ–¹æ³•éƒ½è¦å†™åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œé¢ï¼Œæ¯”å¦‚æ—¥å¿—æ¡†æ¶çš„é…ç½®ã€æ¨é€é€šçŸ¥æ¡†æ¶ã€ç¬¬ä¸‰æ–¹æ”¯ä»˜å›è°ƒé…ç½®...è¿˜æœ‰ä¸€å¤§å †å·¥å…·ç±»é…ç½®ã€‚

æ‰€ä»¥æˆ‘ä¹ æƒ¯ä¸Šä¼šæŠŠä¸åŒçš„é…ç½®æ–‡ä»¶å•ç‹¬å†™åœ¨å„è‡ªçš„åˆ†ç±»ï¼ˆCategoryï¼‰ä¸­ã€‚

å…·ä½“åŸå› å¯ä»¥å»çœ‹çœ‹ã€ŠEffective Objective-C 2.0 ç¼–å†™é«˜è´¨é‡ iOS ä¸ OS X ä»£ç çš„ 52 ä¸ªæœ‰æ•ˆæ–¹æ³• ã€‹ä¸€ä¹¦ä¸­çš„ç¬¬ 24 æ¡å»ºè®®ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ–°å»ºä¸€ä¸ª `AppDelegate` åˆ†ç±»æ–‡ä»¶ï¼Œç„¶åæŠŠæ‰€æœ‰ä¸åˆå§‹åŒ– CYLTabBarController æ¡†æ¶ç›¸å…³çš„ä»£ç éƒ½å†™åœ¨ `AppDelegate+CYLTabBar` æ–‡ä»¶é‡Œé¢ï¼Œä¿æŒä»£ç æ•´æ´ï¼Œæ–¹ä¾¿ä¿®æ”¹ã€‚

1. æ–°å»ºä¸€ä¸ª  `AppDelegate`  åˆ†ç±»æ–‡ä»¶ã€‚

   ç‚¹å‡» Xcode å¯¼èˆªæ  â€” File â€” New â€” File...â€” é€‰æ‹© iOS Source åˆ—è¡¨ä¸‹çš„ã€ŒObjective-C Fileã€ï¼Œæ–°å»ºæ–‡ä»¶ç±»å‹å’Œæ–‡ä»¶åå¦‚ä¸‹ï¼š

   ![](https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/025012.png)

2. åœ¨ Assets.xcassets èµ„äº§åº“ä¸­å¯¼å…¥ä½ æ‰€éœ€è¦çš„å›¾ç‰‡æ–‡ä»¶ã€‚

3. åœ¨åˆ†ç±»ä¸­æ–°å»ºä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºé…ç½®ä¸»çª—å£ï¼š

```objective-c
#import "AppDelegate.h"

NS_ASSUME_NONNULL_BEGIN

/// è¿™æ˜¯ AppDelegate çš„åˆ†ç±»ï¼Œç”¨äºé…ç½® CYLTabBarController
@interface AppDelegate (CYLTabBar)

/// é…ç½®ä¸»çª—å£
- (void)hql_configureForTabBarController;

@end

NS_ASSUME_NONNULL_END
```

ç„¶åæˆ‘ä»¬åœ¨ .m æ–‡ä»¶ä¸­å®ç°å®ƒï¼Œè®¾ç½® `CYLTabBarController` çš„ä¸¤ä¸ªæ•°ç»„ï¼šæ§åˆ¶å™¨æ•°ç»„å’Œé…ç½® tabBar å¤–è§‚æ ·å¼çš„å±æ€§æ•°ç»„ï¼š

```objective-c
@implementation AppDelegate (CYLTabBar)

#pragma mark - Public

- (void)hql_configureForTabBarController {
    // è®¾ç½®ä¸»çª—å£ï¼Œå¹¶è®¾ç½®æ ¹è§†å›¾æ§åˆ¶å™¨
    self.window = [[UIWindow alloc] initWithFrame:[[UIScreen mainScreen] bounds]];
    self.window.backgroundColor = [UIColor whiteColor];
    [self.window makeKeyAndVisible];

    // åˆå§‹åŒ– CYLTabBarController å¯¹è±¡
    CYLTabBarController *tabBarController =
        [CYLTabBarController tabBarControllerWithViewControllers:[self viewControllers]
                                           tabBarItemsAttributes:[self tabBarItemsAttributes]];
    // è®¾ç½®éµå®ˆå§”æ‰˜åè®®
    tabBarController.delegate = self;
    // å°† CYLTabBarController è®¾ç½®ä¸º window çš„ RootViewController
    self.window.rootViewController = tabBarController;
}

#pragma mark - Private

/// æ§åˆ¶å™¨æ•°ç»„
- (NSArray *)viewControllers {
    // é¦–é¡µ
    HomeViewController *homeVC = [[HomeViewController alloc] init];
    homeVC.navigationItem.title = @"é¦–é¡µ";
    CYLBaseNavigationController *homeNC = [[CYLBaseNavigationController alloc] initWithRootViewController:homeVC];
    [homeNC cyl_setHideNavigationBarSeparator:YES];
    
    // åŒåŸ
    MyCityViewController *myCityVC = [[MyCityViewController alloc] init];
    myCityVC.navigationItem.title = @"åŒåŸ";
    CYLBaseNavigationController *myCityNC = [[CYLBaseNavigationController alloc] initWithRootViewController:myCityVC];
    [myCityNC cyl_setHideNavigationBarSeparator:YES];
    
    // æ¶ˆæ¯
    MessageViewController *messageVC = [[MessageViewController alloc] init];
    messageVC.navigationItem.title = @"æ¶ˆæ¯";
    CYLBaseNavigationController *messageNC = [[CYLBaseNavigationController alloc] initWithRootViewController:messageVC];
    [messageNC cyl_setHideNavigationBarSeparator:YES];
    
    // æˆ‘çš„
    AccountViewController *accountVC = [[AccountViewController alloc] init];
    accountVC.navigationItem.title = @"æˆ‘çš„";
    CYLBaseNavigationController *accountNC = [[CYLBaseNavigationController alloc] initWithRootViewController:accountVC];
    [accountNC cyl_setHideNavigationBarSeparator:YES];
    
    NSArray *viewControllersArray = @[homeNC, myCityNC, messageNC, accountNC];
    return viewControllersArray;
}

/// tabBar å±æ€§æ•°ç»„
- (NSArray *)tabBarItemsAttributes {
    NSDictionary *homeTabBarItemsAttributes = @{
        CYLTabBarItemTitle: @"é¦–é¡µ",
        CYLTabBarItemImage: @"home_normal",
        CYLTabBarItemSelectedImage: @"home_highlight",
    };
    NSDictionary *myCityTabBarItemsAttributes = @{
        CYLTabBarItemTitle: @"åŒåŸ",
        CYLTabBarItemImage: @"mycity_normal",
        CYLTabBarItemSelectedImage: @"mycity_highlight",
    };
    NSDictionary *messageTabBarItemsAttributes = @{
        CYLTabBarItemTitle: @"æ¶ˆæ¯",
        CYLTabBarItemImage: @"message_normal",
        CYLTabBarItemSelectedImage: @"message_highlight",
    };
    NSDictionary *accountTabBarItemsAttributes = @{
        CYLTabBarItemTitle: @"æˆ‘çš„",
        CYLTabBarItemImage: @"account_normal",
        CYLTabBarItemSelectedImage: @"account_highlight",
    };

    NSArray *tabBarItemsAttributes = @[
        homeTabBarItemsAttributes,
        myCityTabBarItemsAttributes,
        messageTabBarItemsAttributes,
        accountTabBarItemsAttributes
    ];
    return tabBarItemsAttributes;
}

@end
```

4. æœ€åï¼Œæˆ‘ä»¬å›åˆ° `AppDelegate.m` æ–‡ä»¶ï¼Œå¯¼å…¥ä¸Šä¸€æ­¥æ–°å»ºçš„åˆ†ç±»å¤´æ–‡ä»¶ :

   ```objective-c
   #import "AppDelegate+CYLTabBar.h"
   ```

5. ç„¶åä¸€è¡Œä»£ç è°ƒç”¨é…ç½®ä¸»çª—å£çš„æ–¹æ³•ï¼š

   ```objective-c
   #import "AppDelegate.h"
   #import "AppDelegate+CYLTabBar.h" // å¯¼å…¥çš„åˆ†ç±»æ–‡ä»¶
   
   @implementation AppDelegate
   
   
   - (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
       
       // è°ƒç”¨åˆ†ç±»æ–‡ä»¶ä¸­çš„é…ç½®ä¸»çª—å£æ–¹æ³•ï¼š
       [self hql_configureForTabBarController];
       
       return YES;
   }
   
   @end
   ```

6. è‡³æ­¤ï¼Œå¸¸è§çš„å¸¦ 4 ä¸ª TabBarItem çš„åº”ç”¨æ¡†æ¶å°±æ­å»ºå¥½å•¦ï¼š

   ![é€šç”¨çš„ tabBar æ ·å¼](https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/031149.jpg)



å°ç»“ï¼šå°† `CYLTabBarController` å®ä¾‹åŒ–ä¸ºçª—å£çš„æ ¹è§†å›¾æ§åˆ¶å™¨å³å¯ã€‚



### ç¬¬ä¸‰æ­¥ï¼šæ·»åŠ ä¸è§„åˆ™åŠ å·æŒ‰é’®

åˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ª `CYLPlusButton` çš„å­ç±»å¯¹è±¡ `CYLPlusButtonSubclass`ã€‚

#### `CYLPlusButtonSubclass.h` å£°æ˜éµå®ˆ `<CYLPlusButtonSubclassing>` åè®®

```objective-c
#import "CYLPlusButton.h"

NS_ASSUME_NONNULL_BEGIN

@interface CYLPlusButtonSubclass : CYLPlusButton <CYLPlusButtonSubclassing>

@end

NS_ASSUME_NONNULL_END
```



#### `CYLPlusButtonSubclass.m` ä¸­å®ç°åˆ›å»ºæŒ‰é’®çš„æ–¹æ³•å’Œéµå®ˆçš„åè®®æ–¹æ³•

```objective-c
#import "CYLPlusButtonSubclass.h"

@implementation CYLPlusButtonSubclass

#pragma mark - Lifecycle

- (instancetype)initWithFrame:(CGRect)frame {
    if (self = [super initWithFrame:frame]) {
        self.titleLabel.textAlignment = NSTextAlignmentCenter;
        self.adjustsImageWhenHighlighted = NO;
    }
    return self;
}

//ä¸Šä¸‹ç»“æ„çš„ button
- (void)layoutSubviews {
    [super layoutSubviews];

    // æ§ä»¶å¤§å°,é—´è·å¤§å°
    // æ³¨æ„ï¼šä¸€å®šè¦æ ¹æ®é¡¹ç›®ä¸­çš„å›¾ç‰‡å»è°ƒæ•´ä¸‹é¢çš„0.7å’Œ0.9ï¼ŒDemoä¹‹æ‰€ä»¥è¿™ä¹ˆè®¾ç½®ï¼Œå› ä¸ºdemoä¸­çš„ plusButton çš„ icon ä¸æ˜¯æ­£æ–¹å½¢ã€‚
    CGFloat const imageViewEdgeWidth   = self.bounds.size.width * 0.7;
    CGFloat const imageViewEdgeHeight  = imageViewEdgeWidth;

    CGFloat const centerOfView    = self.bounds.size.width * 0.5;
    CGFloat const labelLineHeight = self.titleLabel.font.lineHeight;
    CGFloat const verticalMargin  = (self.bounds.size.height - labelLineHeight - imageViewEdgeHeight) * 0.5;

    // imageView å’Œ titleLabel ä¸­å¿ƒçš„ Y å€¼
    CGFloat const centerOfImageView  = verticalMargin + imageViewEdgeHeight * 0.5;
    CGFloat const centerOfTitleLabel = imageViewEdgeHeight  + verticalMargin * 2 + labelLineHeight * 0.5 - 1;

    //imageView position ä½ç½®
    self.imageView.bounds = CGRectMake(0, 0, imageViewEdgeWidth, imageViewEdgeHeight);
    self.imageView.center = CGPointMake(centerOfView, centerOfImageView);

    //title position ä½ç½®
    self.titleLabel.bounds = CGRectMake(0, 0, self.bounds.size.width, labelLineHeight);
    self.titleLabel.center = CGPointMake(centerOfView, centerOfTitleLabel);
}

#pragma mark - IBActions

- (void)clickPublish {
    // å¦‚æœæŒ‰é’®çš„ä½œç”¨æ˜¯è§¦å‘ç‚¹å‡»äº‹ä»¶ï¼Œåˆ™è°ƒç”¨æ­¤æ–¹æ³•
}

#pragma mark - CYLPlusButtonSubclassing

+ (id)plusButton {
    CYLPlusButtonSubclass *button = [CYLPlusButtonSubclass buttonWithType:UIButtonTypeCustom];
    // å›¾ç‰‡å°ºå¯¸ï¼š56*56ã€67*66ã€49*48ï¼ˆå‡¸å‡º 15ï¼‰
    UIImage *normalButtonImage = [UIImage imageNamed:@"post_normal"];
    UIImage *hlightButtonImage = [UIImage imageNamed:@"post_highlight"];
    [button setImage:normalButtonImage forState:UIControlStateNormal];
    [button setImage:hlightButtonImage forState:UIControlStateHighlighted];
    [button setImage:hlightButtonImage forState:UIControlStateSelected];
    
    // è®¾ç½®èƒŒæ™¯å›¾ç‰‡
//    UIImage *normalButtonBackImage = [UIImage imageNamed:@"tabBar_post_back"];
//    [button setBackgroundImage:normalButtonBackImage forState:UIControlStateNormal];
//    [button setBackgroundImage:normalButtonBackImage forState:UIControlStateSelected];

    
    // æŒ‰é’®å›¾ç‰‡è·ç¦»ä¸Šè¾¹è·å¢åŠ  5ï¼Œå³å‘ä¸‹åç§»ï¼ŒæŒ‰é’®å›¾ç‰‡è·ç¦»ä¸‹è¾¹è·å‡å°‘ 5ï¼Œå³å‘ä¸‹åç§»ã€‚
    //button.imageEdgeInsets = UIEdgeInsetsMake(5, 0, -5, 0);
    [button setTitle:@"å‘å¸ƒ" forState:UIControlStateNormal];
    [button setTitleColor:[UIColor grayColor] forState:UIControlStateNormal];
    
    button.titleLabel.font = [UIFont systemFontOfSize:10 weight:UIFontWeightBold];
    [button sizeToFit]; // or set frame in this way `button.frame = CGRectMake(0.0, 0.0, 250, 100);`
    
    
    //è‡ªå®šä¹‰å®½åº¦
    button.frame = CGRectMake(0.0, 0.0, 59, 59);
    // button.backgroundColor = [UIColor redColor];
    
    // if you use `+plusChildViewController` , do not addTarget to plusButton.
    // [button addTarget:button action:@selector(clickPublish) forControlEvents:UIControlEventTouchUpInside];
    return button;
}

// ç”¨æ¥è‡ªå®šä¹‰åŠ å·æŒ‰é’®çš„ä½ç½®ï¼Œå¦‚æœä¸å®ç°é»˜è®¤å±…ä¸­ã€‚
+ (NSUInteger)indexOfPlusButtonInTabBar {
    return 2;
}

// å®ç°è¯¥æ–¹æ³•åï¼Œèƒ½è®© PlusButton çš„ç‚¹å‡»æ•ˆæœä¸è·Ÿç‚¹å‡»å…¶ä»– TabBar æŒ‰é’®æ•ˆæœä¸€æ ·ï¼Œè·³è½¬åˆ°è¯¥æ–¹æ³•æŒ‡å®šçš„ UIViewController
+ (UIViewController *)plusChildViewController {

    UIViewController *v = [[UIViewController alloc] init];
    return v;
}

// è¯¥æ–¹æ³•æ˜¯ä¸ºäº†è°ƒæ•´ PlusButton ä¸­å¿ƒç‚¹Yè½´æ–¹å‘çš„ä½ç½®ï¼Œå»ºè®®åœ¨æŒ‰é’®è¶…å‡ºäº† tabbar çš„è¾¹ç•Œæ—¶å®ç°è¯¥æ–¹æ³•ã€‚
// è¿”å›å€¼æ˜¯è‡ªå®šä¹‰æŒ‰é’®ä¸­å¿ƒç‚¹ Y è½´æ–¹å‘çš„åæ ‡é™¤ä»¥ tabbar çš„é«˜åº¦ï¼Œå°äº 0.5 è¡¨ç¤º PlusButton åä¸Šï¼Œå¤§äº 0.5 åˆ™è¡¨ç¤ºåä¸‹ã€‚
// PlusButtonCenterY = multiplierOfTabBarHeight * tabBarHeight + constantOfPlusButtonCenterYOffset;
+ (CGFloat)multiplierOfTabBarHeight:(CGFloat)tabBarHeight {
    return  0.3;
}

// constantOfPlusButtonCenterYOffset å¤§äº 0 ä¼šå‘ä¸‹åç§»ï¼Œå°äº 0 ä¼šå‘ä¸Šåç§»ã€‚
+ (CGFloat)constantOfPlusButtonCenterYOffsetForTabBarHeight:(CGFloat)tabBarHeight {
    return (CYL_IS_IPHONE_X ? - 6 : 4);
}

@end
```



#### åœ¨ `AppDelegate+CYLTabBar.m` ä¸­æ³¨å†Œè¯¥æŒ‰é’®

åœ¨åˆå§‹åŒ– `CYLTabBarController` å¯¹è±¡æ­¥éª¤ä¹‹å‰æ³¨å†ŒæŒ‰é’®ï¼š

```objective-c
- (void)hql_configureForTabBarController {
    // è®¾ç½®ä¸»çª—å£ï¼Œå¹¶è®¾ç½®æ ¹è§†å›¾æ§åˆ¶å™¨
    self.window = [[UIWindow alloc] initWithFrame:[[UIScreen mainScreen] bounds]];
    self.window.backgroundColor = [UIColor whiteColor];
    [self.window makeKeyAndVisible];
    
    // ğŸ’¡ğŸ’¡ğŸ’¡ æ³¨å†ŒåŠ å·æŒ‰é’®
    [CYLPlusButtonSubclass registerPlusButton];
    
    // åˆå§‹åŒ– CYLTabBarController å¯¹è±¡
    CYLTabBarController *tabBarController =
        [CYLTabBarController tabBarControllerWithViewControllers:[self viewControllers]
                                           tabBarItemsAttributes:[self tabBarItemsAttributes]];
    // è®¾ç½®éµå®ˆå§”æ‰˜åè®®
    tabBarController.delegate = self;
    self.window.rootViewController = tabBarController;
}
```



è‡ªæ­¤ï¼ŒåŠ å·æŒ‰é’®ä¹Ÿæ·»åŠ å®Œæˆå•¦ã€‚

![å¸¦ä¸è§„åˆ™åŠ å·çš„ tabBar æ ·å¼](https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/073824.jpg)





### ç¬¬å››æ­¥ï¼šè®¾ç½®è‡ªå®šä¹‰ TabBar æ ·å¼

è‡ªå®šä¹‰ TabBar å­—ä½“ã€èƒŒæ™¯ã€é˜´å½±ã€‚

åœ¨ `AppDelegate+CYLTabBar.m` æ–‡ä»¶ä¸­æ–°å¢ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºè®¾ç½® TabBar æ ·å¼ï¼š

```objective-c
/// è‡ªå®šä¹‰ TabBar å­—ä½“ã€èƒŒæ™¯ã€é˜´å½±
- (void)customizeTabBarInterface {
    // æ™®é€šçŠ¶æ€ä¸‹çš„æ–‡å­—å±æ€§
    NSMutableDictionary *normalAttrs = [NSMutableDictionary dictionary];
    normalAttrs[NSForegroundColorAttributeName] = [UIColor cyl_systemGrayColor];
    
    // é€‰ä¸­çŠ¶æ€ä¸‹çš„æ–‡å­—å±æ€§
    NSMutableDictionary *selectedAttrs = [NSMutableDictionary dictionary];
    selectedAttrs[NSForegroundColorAttributeName] = [UIColor cyl_labelColor];
    
    // è®¾ç½®æ–‡å­—å±æ€§
    UITabBarItem *tabBar = [UITabBarItem appearance];
    [tabBar setTitleTextAttributes:normalAttrs forState:UIControlStateNormal];
    [tabBar setTitleTextAttributes:normalAttrs forState:UIControlStateHighlighted];
    
    // è®¾ç½® TabBar èƒŒæ™¯é¢œè‰²ï¼šç™½è‰²
    // ğŸ’¡[UIImage imageWithColor] è¡¨ç¤ºæ ¹æ®æŒ‡å®šé¢œè‰²ç”Ÿæˆå›¾ç‰‡ï¼Œè¯¥æ–¹æ³•æ¥è‡ª <YYKit> æ¡†æ¶
    [[UITabBar appearance] setBackgroundImage:[UIImage imageWithColor:[UIColor whiteColor]]];
    
    // å»é™¤ TabBar è‡ªå¸¦çš„é¡¶éƒ¨é˜´å½±
    [[self cyl_tabBarController] hideTabBarShadowImageView];
    
    // è®¾ç½® TabBar é˜´å½±ï¼Œæ— æ•ˆ
    // [[UITabBar appearance] setShadowImage:[UIImage imageNamed:@"tabBar_background_shadow"]];
    
    // è®¾ç½® TabBar é˜´å½±
    CYLTabBarController *tabBarController = [self cyl_tabBarController];
    tabBarController.tabBar.layer.shadowColor = [UIColor blackColor].CGColor;
    tabBarController.tabBar.layer.shadowRadius = 15.0;
    tabBarController.tabBar.layer.shadowOpacity = 0.2;
    tabBarController.tabBar.layer.shadowOffset = CGSizeMake(0, 3);
    tabBarController.tabBar.layer.masksToBounds = NO;
    tabBarController.tabBar.clipsToBounds = NO;
}
```

ç„¶ååœ¨è¯¥æ–‡ä»¶çš„é…ç½®æ–¹æ³•ä¸­è°ƒç”¨ï¼š

```objective-c
- (void)hql_configureForTabBarController {
    // è®¾ç½®ä¸»çª—å£ï¼Œå¹¶è®¾ç½®æ ¹è§†å›¾æ§åˆ¶å™¨
    self.window = [[UIWindow alloc] initWithFrame:[[UIScreen mainScreen] bounds]];
    self.window.backgroundColor = [UIColor whiteColor];
    [self.window makeKeyAndVisible];
    
    // æ³¨å†ŒåŠ å·æŒ‰é’®
    [CYLPlusButtonSubclass registerPlusButton];
    
    // åˆå§‹åŒ– CYLTabBarController å¯¹è±¡
    CYLTabBarController *tabBarController =
        [CYLTabBarController tabBarControllerWithViewControllers:[self viewControllers]
                                           tabBarItemsAttributes:[self tabBarItemsAttributes]];
    // è®¾ç½®éµå®ˆå§”æ‰˜åè®®
    tabBarController.delegate = self;
    self.window.rootViewController = tabBarController;
    
    // ğŸ’¡ğŸ’¡ğŸ’¡ è‡ªå®šä¹‰ TabBar å­—ä½“ã€èƒŒæ™¯ã€é˜´å½±
     [self customizeTabBarInterface];
}
```

å¦å¤–ï¼Œä¸è§„åˆ™åŠ å·æŒ‰é’®çš„èƒŒæ™¯å›¾ç‰‡éœ€è¦åœ¨ `CYLPlusButtonSubclass.m` æ–‡ä»¶çš„ `+ (id)plusButton` ä¸­è®¾ç½®ï¼š

```objective-c
// è®¾ç½®èƒŒæ™¯å›¾ç‰‡
UIImage *normalButtonBackImage = [UIImage imageNamed:@"tabBar_post_back"];
[button setBackgroundImage:normalButtonBackImage forState:UIControlStateNormal];
[button setBackgroundImage:normalButtonBackImage forState:UIControlStateSelected];
```

ä¸‹é¢æ˜¯è‡ªå®šä¹‰åçš„ TabBar æ ·å¼ç¤ºä¾‹ï¼š

![è‡ªå®šä¹‰ TabBar æ ·å¼](https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/074517.jpg)



### ç¬¬äº”æ­¥ï¼šæ·»åŠ ç‚¹å‡»æ—‹è½¬åŠ¨ç”»

å½“ç‚¹å‡» TabBarItem æ—¶ï¼Œä¸ºå®ƒè®¾ç½®æ—‹è½¬åŠ¨ç”»ï¼Œéœ€è¦è®© AppDelegate éµå®ˆ `<CYLTabBarControllerDelegate, UITabBarControllerDelegate>` å§”æ‰˜åè®®ï¼Œä»¥ç›‘å¬ç‚¹å‡»è§¦å‘äº‹ä»¶ï¼š

```
// ğŸ’¡ğŸ’¡ğŸ’¡ å£°æ˜éµå®ˆå§”æ‰˜åè®®
@interface AppDelegate () <CYLTabBarControllerDelegate, UITabBarControllerDelegate>

@end

@implementation AppDelegate (CYLTabBar)

- (void)hql_configureForTabBarController {
		
		// çœç•¥...
    
    // åˆå§‹åŒ– CYLTabBarController å¯¹è±¡
    CYLTabBarController *tabBarController =
        [CYLTabBarController tabBarControllerWithViewControllers:[self viewControllers]
                                           tabBarItemsAttributes:[self tabBarItemsAttributes]];
    // ğŸ’¡ğŸ’¡ğŸ’¡ è®¾ç½®è®© AppDelegate éµå®ˆå§”æ‰˜åè®®
    tabBarController.delegate = self;
    self.window.rootViewController = tabBarController;
}
```

æ¥ä¸‹æ¥æ˜¯è®© AppDelegate å®ç°å§”æ‰˜åè®®æ–¹æ³•ï¼Œç‚¹å‡» TabBarItem æ—¶è§¦å‘æ—‹è½¬åŠ¨ç”»ï¼Œç‚¹ä¸è§„åˆ™åŠ å·æŒ‰é’®æ—¶è§¦å‘æ”¾å¤§åŠ¨ç”»ï¼š

```objective-c
- (BOOL)tabBarController:(UITabBarController *)tabBarController shouldSelectViewController:(UIViewController *)viewController {
    // ç¡®ä¿ PlusButton çš„é€‰ä¸­çŠ¶æ€
    [[self cyl_tabBarController] updateSelectionStatusIfNeededForTabBarController:tabBarController shouldSelectViewController:viewController];
    return YES;
}

- (void)tabBarController:(UITabBarController *)tabBarController didSelectControl:(UIControl *)control {
    UIView *animationView;
    NSLog(@"ğŸ”´\n ç±»åä¸æ–¹æ³•åï¼š%@ï¼Œ\n ç¬¬ %@ è¡Œï¼Œ\n description : %@ï¼Œ\n tabBarChildViewControllerIndex: %@ï¼Œ tabBarItemVisibleIndex : %@", @(__PRETTY_FUNCTION__), @(__LINE__), control, @(control.cyl_tabBarChildViewControllerIndex), @(control.cyl_tabBarItemVisibleIndex));
    
    // å³ä½¿ PlusButton ä¹Ÿæ·»åŠ äº†ç‚¹å‡»äº‹ä»¶ï¼Œç‚¹å‡» PlusButton åä¹Ÿä¼šè§¦å‘è¯¥ä»£ç†æ–¹æ³•ã€‚
    if ([control cyl_isPlusButton]) {
        UIButton *button = CYLExternPlusButton;
        animationView = button.imageView;
        // ä¸ºåŠ å·æŒ‰é’®æ·»åŠ ã€Œç¼©æ”¾åŠ¨ç”»ã€
        [self addScaleAnimationOnView:animationView repeatCount:1];
    } else if ([control isKindOfClass:NSClassFromString(@"UITabBarButton")]) {
        for (UIView *subView in control.subviews) {
            if ([subView isKindOfClass:NSClassFromString(@"UITabBarSwappableImageView")]) {
                animationView = subView;
                // ä¸ºå…¶ä»–æŒ‰é’®æ·»åŠ ã€Œæ—‹è½¬åŠ¨ç”»ã€
                [self addRotateAnimationOnView:animationView];
            }
        }
    }
}

/// ç¼©æ”¾åŠ¨ç”»
- (void)addScaleAnimationOnView:(UIView *)animationView repeatCount:(float)repeatCount {
    //éœ€è¦å®ç°çš„å¸§åŠ¨ç”»ï¼Œè¿™é‡Œæ ¹æ®éœ€æ±‚è‡ªå®šä¹‰
    CAKeyframeAnimation *animation = [CAKeyframeAnimation animation];
    animation.keyPath = @"transform.scale";
     animation.values = @[@1.0,@1.3,@0.9,@1.15,@0.95,@1.02,@1.0];
    animation.duration = 0.5;
    animation.repeatCount = repeatCount;
    animation.calculationMode = kCAAnimationCubic;
    [animationView.layer addAnimation:animation forKey:nil];
}

/// æ—‹è½¬åŠ¨ç”»
- (void)addRotateAnimationOnView:(UIView *)animationView {
   [UIView animateWithDuration:0.32 delay:0 options:UIViewAnimationOptionCurveEaseIn animations:^{
       animationView.layer.transform = CATransform3DMakeRotation(M_PI, 0, 1, 0);
   } completion:nil];
   
   dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(0.2 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{
       [UIView animateWithDuration:0.70 delay:0 usingSpringWithDamping:1 initialSpringVelocity:0.2 options:UIViewAnimationOptionCurveEaseOut animations:^{
           animationView.layer.transform = CATransform3DMakeRotation(2 * M_PI, 0, 1, 0);
       } completion:nil];
   });
}
```

å®ç°æ•ˆæœï¼š

![å¸¦æ—‹è½¬åŠ¨ç”»çš„ TabBar](https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/075457.gif)



### ç¬¬å…­æ­¥ï¼šæ·»åŠ  Lottie åŠ¨ç”»

å‚è€ƒï¼š<https://github.com/ChenYilong/CYLTabBarController/issues/341>

é¦–å…ˆï¼Œä¸ºæ–¹ä¾¿æ¼”ç¤ºï¼Œæˆ‘ä»¬ä»å®˜æ–¹ Demo ä¸­è·å– Lottie åŠ¨ç”»çš„ JSON æ–‡ä»¶å’Œç›¸å…³èµ„æºæ–‡ä»¶ã€‚

![Lottie èµ„æºæ–‡ä»¶](https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/Jietu20191018-155746%402x.png)



ç„¶åï¼Œä¿®æ”¹é…ç½® tabBar å±æ€§æ•°ç»„çš„æ–¹æ³• `- (NSArray *)tabBarItemsAttributes`ï¼ŒæŠŠ Lottie æ–‡ä»¶çš„ URL è·¯å¾„åŠ ä¸Šï¼š

```objective-c
/*
 * tabBar å±æ€§æ•°ç»„ï¼Œå¸¦ Loggie åŠ¨ç”»
 * å‚è€ƒï¼š<https://github.com/ChenYilong/CYLTabBarController/issues/341>
 *
 * ä¸ä¸Šé¢çš„é…ç½®ç›¸æ¯”ï¼Œéœ€è¦å†å¤šè®¾ç½®ä¸¤ä¸ªå±æ€§ï¼š
 *   CYLTabBarLottieURL: ä¼ å…¥ lottie åŠ¨ç”» JSON æ–‡ä»¶æ‰€åœ¨è·¯å¾„
 *   CYLTabBarLottieSize: LottieView å¤§å°ï¼Œé€‰å¡«
 *
 */
- (NSArray *)tabBarItemsAttributes {
    NSDictionary *homeTabBarItemsAttributes = @{
        CYLTabBarItemTitle: @"é¦–é¡µ",
        CYLTabBarLottieURL : [NSURL fileURLWithPath:[[NSBundle mainBundle] pathForResource:@"tab_home_animate" ofType:@"json"]],
        CYLTabBarLottieSize: [NSValue valueWithCGSize:CGSizeMake(33, 33)],
    };
    NSDictionary *myCityTabBarItemsAttributes = @{
        CYLTabBarItemTitle: @"åŒåŸ",
        CYLTabBarLottieURL : [NSURL fileURLWithPath:[[NSBundle mainBundle] pathForResource:@"tab_search_animate" ofType:@"json"]],
        CYLTabBarLottieSize: [NSValue valueWithCGSize:CGSizeMake(33, 33)],
    };
    NSDictionary *messageTabBarItemsAttributes = @{
        CYLTabBarItemTitle: @"æ¶ˆæ¯",
        CYLTabBarLottieURL : [NSURL fileURLWithPath:[[NSBundle mainBundle] pathForResource:@"tab_message_animate" ofType:@"json"]],
        CYLTabBarLottieSize: [NSValue valueWithCGSize:CGSizeMake(33, 33)],
    };
    NSDictionary *accountTabBarItemsAttributes = @{
        CYLTabBarItemTitle: @"æˆ‘çš„",
        CYLTabBarLottieURL : [NSURL fileURLWithPath:[[NSBundle mainBundle] pathForResource:@"tab_me_animate" ofType:@"json"]],
        CYLTabBarLottieSize: [NSValue valueWithCGSize:CGSizeMake(33, 33)],
    };

    NSArray *tabBarItemsAttributes = @[
        homeTabBarItemsAttributes,
        myCityTabBarItemsAttributes,
        messageTabBarItemsAttributes,
        accountTabBarItemsAttributes
    ];
    return tabBarItemsAttributes;
}
```

![å¸¦ Lottie åŠ¨ç”»çš„ TabBar ç¤ºä¾‹](https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/080148.gif)



è‡ªæ­¤ï¼Œæˆ‘ä»¬é€šè¿‡ CYLTabBarController æ¡†æ¶å®ç°äº†ä¸€ä¸ªä»¿ã€Œé—²é±¼ã€TabBar åŠ¨ç”»çš„åº”ç”¨ã€‚

